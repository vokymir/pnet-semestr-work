@page "/ptackari"
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage
@inject BirdApiClient BAC

<PageTitle>Ptáčkaři</PageTitle>

<h1 class="mb-4">Ptáčkaři</h1>
<HelpBox InitiallyVisible="false">
        <p>
            Můžeš se starat o více ptáčkařů – tedy o sebe, sourozence nebo kamarády, kteří s tebou pozorují ptáčky.
        </p>
        <p>
            Představ si, že jdete s rodinou na procházku. Všichni jste ptáčkaři a uvidíte čápa. Buď každý vytáhne mobil a zaznamená ho zvlášť…
            <br />
            Anebo stačí, když záznam vytvoříš Ty a označíš, že ho viděli všichni.
        </p>
        <p>
            Každý ptáčkař má svůj vlastní speciální kód. Když si vytvoříš ptáčkařský profil (<strong>Vytvořit ptáčkaře</strong>), jeden takový kód dostaneš.
        </p>
        <p>
            Když Ti někdo svůj kód řekne, můžeš si ho přidat do aplikace (<strong>Přidat existujícího</strong>) a spravovat jeho záznamy.
        </p>
</HelpBox>

<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-4">
    <Button Type="ButtonType.Link" To="/ptackar/novy" Color="ButtonColor.Primary" class="px-4">
        ➕ Vytvořit ptáčkaře
    </Button>
    <Button Color="ButtonColor.Secondary" class="px-4" @onclick="ShowModal">
        ➕ Přidat existujícího
    </Button>
</div>

<AddWatcherModal @ref="AddModal" OnWatcherAdded="ReloadWatchers" />

@if (W == null || !W.Any())
{
    <div class="alert alert-info text-center">
        Žádní ptáčkaři k zobrazení.
    </div>
}
else
{
    <div class="row g-4">
        @foreach (var watcher in W)
        {
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                <Card class="h-100 shadow-sm border rounded">
                    <CardBody class="d-flex flex-column justify-content-between">
                        <div>
                            <CardTitle class="fs-5 fw-semibold mb-1">@watcher.FirstName @watcher.LastName</CardTitle>
                            <CardText class="text-muted mb-3"><code>@watcher.PublicIdentifier</code></CardText>
                        </div>
                        <Button Color="ButtonColor.Primary" To=@($"/ptackar/{watcher.PublicIdentifier}/{watcher.Id}")
                            Type="ButtonType.Link" class="w-100">
                            Zobrazit
                        </Button>
                    </CardBody>
                </Card>
            </div>
        }
    </div>
}

@code {
    private ICollection<WatcherDto>? W = null;
    private AddWatcherModal? AddModal;

    protected override async Task OnInitializedAsync()
    {
        await ReloadWatchers();
    }

    private async Task ReloadWatchers()
    {
        W = await BAC.Watcher_GetUserWatchersAsync();
        StateHasChanged();
    }

    private async Task ShowModal()
    {
        if (AddModal is not null)
            await AddModal.ShowAsync();
    }
}
